#영향점 

> x<-c(15,26,10,9,15,20,18,11,8,20,7,9,10,11,11,10,12,42,17,11,10)
> y<-c(95,71,83,91,102,87,93,100,104,94,113,96,83,84,102,100,105,57,121,86,100)
> fit<-lm(y~x)
> fit

Call:
  lm(formula = y ~ x)

Coefficients:
  (Intercept)            x  
109.874       -1.127  


#x이상점 
> lm.influence(fit)
$hat   #h11=0.047 , h22=0.154 
1          2          3          4          5          6          7 
0.04792248 0.15451323 0.06281578 0.07054521 0.04792248 0.07261896 0.05798959 
8          9         10         11         12         13         14 
0.05666993 0.07985823 0.07261896 0.09075485 0.07054521 0.06281578 0.05666993 
15         16         17         18         19         20         21 
0.05666993 0.06281578 0.05210768 0.65160998 0.05305030 0.05666993 0.06281578 
                                 #이상점 (특별하게 큼)
$coefficients
(Intercept)            x
1   0.086545033  0.001045618
2   0.958749611 -0.104156236
3  -1.623423657  0.057755211
4  -1.022877601  0.040022565
5   0.384830249  0.004649436
6   0.005894578 -0.001602673
7   0.023216186  0.010379001
8   0.230329653 -0.007159985
9   0.410719785 -0.017252806
10 -0.117621441  0.031980023
11  1.595051450 -0.070799821
12 -0.437100147  0.017102603
13 -1.623423657  0.057755211
14 -1.230320253  0.038245507
15  0.412910892 -0.012835671
16  0.145243868 -0.005167222
17  0.681955144 -0.017203712
18  4.243970455 -0.347768136
19  0.569162106  0.066321856
20 -1.047739014  0.032569820
21  0.145243868 -0.005167222

$sigma
1         2         3         4         5         6         7         8 
11.314330 11.055957 10.668705 11.121977 11.112860 11.324667 11.294609 11.308398 
9        10        11        12        13        14        15        16 
11.298614 11.206822 10.992783 11.288168 10.668705 10.842422 11.271643 11.319860 
17        18        19        20        21 
11.129664 11.106756  8.628196 10.977128 11.319860 

$wt.res
1           2           3           4           5           6 
2.0309931  -9.5721288 -15.6039514  -8.7309404   9.0309931  -0.3340623 
7           8           9          10          11          12 
3.4119599   2.5230375   3.1420707   6.6659377  11.0150818  -3.7309404 
13          14          15          16          17          18 
-15.6039514 -13.4769625   4.5230375   1.3960486   8.6500264  -5.5403062 
19          20          21 
30.2849710 -11.4769625   1.3960486 


> lm.influence(fit)$hat
1          2          3          4          5          6          7 
0.04792248 0.15451323 0.06281578 0.07054521 0.04792248 0.07261896 0.05798959 
8          9         10         11         12         13         14 
0.05666993 0.07985823 0.07261896 0.09075485 0.07054521 0.06281578 0.05666993 
15         16         17         18         19         20         21 
0.05666993 0.06281578 0.05210768 0.65160998 0.05305030 0.05666993 0.06281578 
                                #이상점 값이 특출나게 큼 
> mean(lm.influence(fit)$hat)
[1] 0.0952381

> 2*mean(lm.influence(fit)$hat) #이 값보다 큰 값인 h1818이 이상점 = 0.65
[1] 0.1904762


> lm.influence(fit)$hat >  2*mean(lm.influence(fit)$hat)
1     2     3     4     5     6     7     8     9    10    11    12    13 
FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE 
14    15    16    17    18    19    20    21 
FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  #TRUE자리가 이상x점

#y이상점
> residuals(fit)
1           2           3           4           5           6 
2.0309931  -9.5721288 -15.6039514  -8.7309404   9.0309931  -0.3340623 
7           8           9          10          11          12 
3.4119599   2.5230375   3.1420707   6.6659377  11.0150818  -3.7309404 
13          14          15          16          17          18 
-15.6039514 -13.4769625   4.5230375   1.3960486   8.6500264  -5.5403062 
19          20          21 
30.2849710 -11.4769625   1.3960486 
#이상점 

> rstandard(fit) #결과에서 큰 값이 어디있나 판단 : 19
1           2           3           4           5           6 
0.18883222 -0.94440639 -1.46226437 -0.82158155  0.83965939 -0.03147039 
7           8           9          10          11          12 
0.31891861  0.23566531  0.29716139  0.62796572  1.04797524 -0.35108151 
13          14          15          16          17          18 
-1.46226437 -1.25882099  0.42247610  0.13082533  0.80601240 -0.85153932 
19          20          21 
2.82336807 -1.07201020  0.13082533 


> rstudent(fit)
1           2           3           4           5           6 
0.18396849 -0.94158335 -1.51081192 -0.81426336  0.83286292 -0.03063183 
7           8           9          10          11          12 
0.31124676  0.22971575  0.28991014  0.61766026  1.05084716 -0.34283148 
13          14          15          16          17          18 
-1.51081192 -1.27977575  0.41315320  0.12739342  0.79828114 -0.84511086 
19          20          21 
3.60697972 -1.07648108  0.12739342 


> c.rs <- 2.78+(2.89-2.78)/5   #k=1,n=21  n=20->2,78 , n=25->2.89
> c.rs
[1] 2.802
> which(rstandard(fit)>c.rs) #이상y점 = 19
19 
19 
> qt(0.975,20-2) #이렇게 찾을 수도 있음
[1] 2.100922
> which(rstudent(fit)>qt(0.975,18))
19 
19 

#영향점 

> dfbetas(fit)  #영향점 판단 
(Intercept)            x
1   0.016637570  0.003284263
2   0.188618998 -0.334797655
3  -0.330976194  0.192385778
4  -0.200040654  0.127884061
5   0.075321673  0.014868527
6   0.001132150 -0.005029364
7   0.004470913  0.032657114
8   0.044302206 -0.022501139
9   0.079067322 -0.054266029
10 -0.022828670  0.101412100
11  0.315604809 -0.228885338
12 -0.084223652  0.053843369
13 -0.330976194  0.192385778
14 -0.246813242  0.125356716
15  0.079679334 -0.040469221
16  0.027908297 -0.016222192
17  0.133275505 -0.054933035
18  0.831116127 -1.112746006  #영향점 
19  0.143480394  0.273168207
20 -0.207606515  0.105443576
21  0.027908297 -0.016222192

> which(dfbetas(fit)>2/sqrt(21)) #영향점 어디에 있나  sqrt(n)
[1] 18

> dffits(fit)#적합값
1            2            3            4            5            6 
0.041274036 -0.402520687 -0.391140045 -0.224328534  0.186855984 -0.008571736 
7            8            9           10           11           12 
0.077223953  0.056303487  0.085407473  0.172840518  0.331996854 -0.094449643 
13           14           15           16           17           18 
-0.391140045 -0.313673908  0.101264129  0.032981383  0.187166128 -1.155778731 
19           20           21 
0.853737107 -0.263846244  0.032981383 

> cooks.distance(fit)
1            2            3            4            5            6 
8.974064e-04 8.149796e-02 7.165814e-02 2.561596e-02 1.774366e-02 3.877627e-05 
7            8            9           10           11           12 
3.130575e-03 1.668209e-03 3.831949e-03 1.543952e-02 5.481014e-02 4.677623e-03 
13           14           15           16           17           18 
7.165814e-02 4.759781e-02 5.361216e-03 5.735845e-04 1.785650e-02 6.781120e-01 
19           20           21 
2.232883e-01 3.451889e-02 5.735845e-04 


> qf(0.5 , 2 , 19)  #유의수준 0.5 자유도2 이상점 19 
[1] 0.7190606

> which(cooks.distance(fit)>qf(0.5, 2 ,19))
named integer(0)